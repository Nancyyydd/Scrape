
# coding: utf-8

# In[4]:

import requests
from bs4 import BeautifulSoup
import numpy as np
import pandas as pd
from __future__ import division


# In[5]:

def getSessionRequest(email, password):
    session_requests = requests.session()
    login_url = 'https://www.alexa.com/secure/login'
    credentials = {'email': email, 'password': password}
    logged_in = session_requests.post(login_url, data=credentials)
    return session_requests


# In[6]:

def getTableFromDomain(domain, session_requests):
    BASE_URL = 'http://www.alexa.com/siteinfo/'
    url = BASE_URL + domain
    response = session_requests.get(url)
    html = response.content
    soup = BeautifulSoup(html,'lxml')
    table = soup.body.find('div', attrs={'id': 'demographics-content'})
    return table


# In[7]:

session_request = getSessionRequest('alex@kazim.org', 'y0ur0ck!')
table = getTableFromDomain('cnn.com', session_request)


# In[24]:

def get_real_demographic(table):
    classs=table.find_all('span',{'class':'pybar-bg'})
    spanstring = []
    for x in classs:
        spanstring.append(str(x))
    
    words = []
    for item in spanstring:
        word=item.split()
        words.append(word)
    
    percentage = []
    for word in words:
        for i in word:
            if "width" in i:
                percentage.append(i)
            
    final_percentage = []
    for percent in percentage:
        final_percentage.append(percent[(percent.index(":")+1):percent.index("%")])
    final_percentage = map(int, final_percentage)
    
    real_demo=[0]*28
    i = 0
    count = 0
    while i < 28:
        real_demo[i] = (final_percentage[count]+final_percentage[count+1])/200
        i = i + 1
        count = count + 2
    return real_demo


# In[25]:

real_demo=get_real_demographic(table)
len(real_demo)


# In[26]:

def makeDfFromRealDemo(domain_name, real_demo):
    dict = {domain_name:real_demo}
    df=pd.DataFrame.from_dict(dict, orient='index', dtype=None)
    return df


# In[27]:

print makeDfFromRealDemo("cnn.com",real_demo)


# In[28]:

customer1 = pd.read_csv('domain_count.txt', sep='\t',header = None, names=["domain","count"])
final_df = pd.DataFrame()


# In[36]:

count1=0
for single_domain in customer1["domain"][0:100]:
    table = getTableFromDomain(single_domain, session_request)
    real_demo = get_real_demographic(table)
    df = makeDfFromRealDemo(single_domain, real_demo)
    final_df=final_df.append(df)
    count1+=1
    print count1


# In[32]:

final_df.columns = ["male", "female", "18-24", "25-34", "35-44", "45-54", "55-64", "65+", "Has Children", "No Children", 
"No_college", "Some_college", "Graduate_School", "College", "$0 - $30K", "$30K - $60K", "$60K - $100K", "$100K+", "Home", "School",
"Work", "African", "African American", "Asian", "Caucasian", "Hispanic", "Middle Eastern", "Other"]
final_df["Count"] = customer1["count"][0:15].values


# In[33]:

pd.set_option('display.max_columns', 29)
final_df


# In[ ]:




# In[ ]:




# In[ ]:



